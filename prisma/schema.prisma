generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // directUrl = env("DIRECT_DATABASE_URL")
}
model Event {
  eventUuid       String      @id @default(uuid())
  time            Int
  action          EventAction
  position        Position
  points          Int
  scoutReportUuid String
  scoutReport     ScoutReport @relation(fields: [scoutReportUuid], references: [uuid], onDelete: Cascade)
  @@index([scoutReportUuid])
}
enum Position {
  NONE
 GRID_ONE_LOW
 GRID_ONE_MID
 GRID_ONE_HIGH
 GRID_TWO_LOW
 GRID_TWO_MID
 GRID_TWO_HIGH
 GRID_THREE_LOW
 GRID_THREE_MID
 GRID_THREE_HIGH
 SCORE_HIGH
 SCORE_MID
 SCORE_LOW
 AUTO_PIECE_ONE
 AUTO_PIECE_TWO
 AUTO_PIECE_THREE
 AUTO_PIECE_FOUR
 START_ONE
 START_TWO
 START_THREE
}
enum EventAction {
  LEAVE
  PICK_UP_CONE
  PICK_UP_CUBE
  SCORE
  DEFENSE
  STARTING_POSITION
}
model FeatureToggle {
  feature String  @id
  enabled Boolean @default(true)
}
// model FlaggedScoutReport {
//   uuid            String      @id @default(uuid())
//   note            String
//   scoutReportUuid String      @unique
//   scoutReport     ScoutReport @relation(fields: [scoutReportUuid], references: [uuid])
// }
model TeamMatchData {
  key           String        @id
  tournamentKey String
  tournament    Tournament    @relation(fields: [tournamentKey], references: [key], onDelete: Cascade)
  matchNumber   Int           @db.SmallInt
  teamNumber    Int
  matchType     MatchType
  scoutReports  ScoutReport[]
  @@index([tournamentKey, teamNumber])
}
enum MatchType {
  QUALIFICATION
  ELIMINATION
}
model MutablePicklist {
  uuid          String      @id @default(uuid())
  teams         Int[]
  authorId      String
  author        User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  name          String
  tournamentKey String?
  tournament    Tournament? @relation(fields: [tournamentKey], references: [key])
}
model ScoutReport {
  uuid               String              @id @default(uuid())
  teamMatchKey       String
  teamMatchData      TeamMatchData       @relation(fields: [teamMatchKey], references: [key], onDelete: Cascade)
  startTime          DateTime
  notes              String
  robotRole          RobotRole
  pickUp             PickUp
  driverAbility      Int
  scouterUuid        String
  scouter            Scouter             @relation(fields: [scouterUuid], references: [uuid], onDelete: Cascade)
  events             Event[]
  autoChargingResult AutoChargingResult
  endChargingResult  EndChargingResult
  // flaggedScoutReport FlaggedScoutReport?
}
enum RobotRole {
  OFFENSE
  DEFENSE
  IMMOBILE
}
enum AutoChargingResult {
  NOTHING
  FAILED
  TIPPED
  ENGAGED
}
enum StartingPiece {
  NOTHING
  CUBE
  CONE
}
enum EndChargingResult {
  NOTHING
  FAILED
  TIPPED
  ENGAGED
}
enum PickUp {
  GROUND
  CHUTE
  SHELF
}
model ScouterScheduleShift {
  uuid                    String         @id @default(uuid())
  sourceTeamNumber        Int
  sourceTeam              RegisteredTeam @relation(fields: [sourceTeamNumber], references: [number], onDelete : Cascade)
  tournamentKey           String
  tournament              Tournament     @relation(fields: [tournamentKey], references: [key], onDelete: Cascade)
  startMatchOrdinalNumber Int
  endMatchOrdinalNumber   Int
  team1                   Scouter[] @relation(name: "Team1")
  team2                   Scouter[] @relation(name: "Team2")
  team3                   Scouter[] @relation(name: "Team3")
  team4                   Scouter[] @relation(name: "Team4")
  team5                   Scouter[] @relation(name: "Team5")
  team6                   Scouter[] @relation(name: "Team6")
}
model Scouter {
  uuid               String         @id @default(uuid())
  name               String?
  sourceTeamNumber   Int
  sourceTeam         RegisteredTeam @relation(fields: [sourceTeamNumber], references: [number], onDelete: Cascade)
  strikes            Int            @default(0)
  scouterReliability Int            @default(0)
  scoutReports       ScoutReport[]
  Team1Shifts                ScouterScheduleShift[] @relation(name: "Team1")
  Team2Shifts                ScouterScheduleShift[] @relation(name: "Team2")
  Team3Shifts                ScouterScheduleShift[] @relation(name: "Team3")
  Team4Shifts                ScouterScheduleShift[] @relation(name: "Team4")
  Team5Shifts                ScouterScheduleShift[] @relation(name: "Team5")
  Team6Shifts                ScouterScheduleShift[] @relation(name: "Team6")
  @@index([sourceTeamNumber])
}
model SharedPicklist {
  uuid          String @id @default(uuid())
  name          String
  totalPoints   Float
  defense       Float
  pickUps       Float
  autoPoints    Float
  driverAbility Float
  teleopPoints  Float
  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)


}
model Team {
  number         Int             @id
  name           String
  registeredTeam RegisteredTeam?
}
model RegisteredTeam {
  number                Int                    @id
  team                  Team                   @relation(fields: [number], references: [number], onDelete: Cascade)
  code                  String                 @unique // 6 digit alphanumeric, case-insensitive code
  email                 String
  emailVerified         Boolean                @default(false)
  teamApproved          Boolean                @default(false)
  website               String?
  scouterScheduleShifts ScouterScheduleShift[]
  scouters              Scouter[]
  users                 User[]
}
model Tournament {
  key                   String                 @id
  name                  String
  location              String?
  date                  String?
  teamMatchData         TeamMatchData[]
  scouterScheduleShifts ScouterScheduleShift[]
  mutablePicklists      MutablePicklist[]
}
model User {
  id               String            @id
  teamNumber       Int?
  team             RegisteredTeam?   @relation(fields: [teamNumber], references: [number], onDelete: Cascade)
  email            String            @unique
  emailVerified    Boolean           @default(false)
  username         String?
  role             UserRole          @default(ANALYST)
  tournamentSource String[]
  teamSource       Int[]
  mutablePicklists MutablePicklist[]
  sharedPicklists  SharedPicklist[]
}
enum UserRole {
  ANALYST
  SCOUTING_LEAD
}